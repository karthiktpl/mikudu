<!DOCTYPE html>
<html lang="en" >

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Mikudu</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
    <link href="css/toaster.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<script type="text/javascript" src="cordova.js"></script>
    
</head>

<body >	
	<div class="navbar navbar-default " role="navigation">
		<div class="container"> 
			<div class="navbar-header">
				<!--<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span> 
				</button>-->
				<a href="index.html#/dashboard"  class="navbar-brand" id="buttonclose"><img src="img/logomain.png" style="margin-bottom: 50px;"></a>
			</div>						
		</div>
	</div>
	<div style="width:100%;height:400px" id="map_canvas"> </div>	
					
</body>
  <toaster-container toaster-options="{'time-out': 3000}"></toaster-container>
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
	<script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
	<script src="js/bootstrap.min.js"></script>


<script type="text/javascript">
$(function(){

$('.indexlink').click(function(){
	div = document.getElementById("map_canvas");
    var tmpmap = plugin.google.maps.Map.getMap(div);
    tmpmap.remove();
	window.location = 'index.html';
	return false;
})
});
var map;
document.addEventListener("deviceready", function() {
	var div = document.getElementById("map_canvas");

  // Initialize the map view

	var storage = window.localStorage; 
	var district=storage.getItem('blooddistrict');
	var value = Setmarkers(district);	
	var map = plugin.google.maps.Map.getMap(div, {
	'camera': {
	  'latLng': new plugin.google.maps.LatLng(value.districtlat.lat,value.districtlat.lng),
	  'zoom': 10
	}
	});
	var locatonList=value.markers;
  // Wait until the map is ready status.
	map.addEventListener(plugin.google.maps.event.MAP_READY, function() {

		for(var locIndex = 0;locIndex<locatonList.length;locIndex++){				
				map.addMarker({
					   'position': plugin.google.maps.LatLng(locatonList[locIndex].lat,locatonList[locIndex].long),
					   'title': locatonList[locIndex].title,
					   'snippet': locatonList[locIndex].snippet
				}, function(marker) {
					  marker.showInfoWindow(); // Show infowindow
				});
		}
	  });
}, false);

function Setmarkers(district)
{
		var markers;
		$.ajax({
		  type: "GET",
		  async: false,
		  global: false,
		  dataType: "json",
		  url: "http://hg.solminds.com/mikuduapi/v1/bloodbanks?district="+district,
		  success: function (result){
			markers=result;
		  }
		});
		return markers;
}
</script>  
</html>
